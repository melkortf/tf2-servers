ARG REGISTRY=ghcr.io
ARG TF2_BASE_TAG=latest
ARG ARCH=i386
FROM ${REGISTRY}/melkortf/tf2-base/${ARCH}:${TF2_BASE_TAG}
LABEL maintainer="garrappachc@gmail.com"

COPY checksum.md5 .

ARG METAMOD_VERSION_MAJOR=1
ARG METAMOD_VERSION_MINOR=12
ARG METAMOD_VERSION_PATCH=0
ARG METAMOD_VERSION_BUILD=1216
ARG METAMOD_VERSION=${METAMOD_VERSION_MAJOR}.${METAMOD_VERSION_MINOR}.${METAMOD_VERSION_PATCH}-git${METAMOD_VERSION_BUILD}
ARG METAMOD_TARBALL_FILE_NAME=mmsource-${METAMOD_VERSION}-linux.tar.gz
ARG METAMOD_TARBALL_URL=https://mms.alliedmods.net/mmsdrop/${METAMOD_VERSION_MAJOR}.${METAMOD_VERSION_MINOR}/${METAMOD_TARBALL_FILE_NAME}

ARG SOURCEMOD_VERSION_MAJOR=1
ARG SOURCEMOD_VERSION_MINOR=12
ARG SOURCEMOD_VERSION_PATCH=0
ARG SOURCEMOD_VERSION_BUILD=7190
ARG SOURCEMOD_VERSION=${SOURCEMOD_VERSION_MAJOR}.${SOURCEMOD_VERSION_MINOR}.${SOURCEMOD_VERSION_PATCH}-git${SOURCEMOD_VERSION_BUILD}
ARG SOURCEMOD_TARBALL_FILE_NAME=sourcemod-${SOURCEMOD_VERSION}-linux.tar.gz
ARG SOURCEMOD_TARBALL_URL=https://sm.alliedmods.net/smdrop/${SOURCEMOD_VERSION_MAJOR}.${SOURCEMOD_VERSION_MINOR}/${SOURCEMOD_TARBALL_FILE_NAME}

RUN wget -nv "${METAMOD_TARBALL_URL}" \
  && wget -nv "${SOURCEMOD_TARBALL_URL}" \
  && md5sum -c checksum.md5 \
  && tar xf "${METAMOD_TARBALL_FILE_NAME}" -C "${SERVER_DIR}/tf" \
  && tar xf "${SOURCEMOD_TARBALL_FILE_NAME}" -C "${SERVER_DIR}/tf" \
  && rm "${METAMOD_TARBALL_FILE_NAME}" \
  && rm "${SOURCEMOD_TARBALL_FILE_NAME}" \
  && rm checksum.md5
